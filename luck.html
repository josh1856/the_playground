<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Quantum Luck ‚Ä¢ Serendipity Engine</title>
<style>
  :root{--bg:#0b0f14;--panel:#101722;--ink:#e6edf3;--muted:#9aa4b2;--hi:#5ac8fa;--ok:#30d158;--warn:#ffd60a;--bad:#ff6b6b}
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:760px;margin:0 auto;padding:18px}
  header{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:12px}
  h1{margin:0;font-size:22px}
  .card{background:#101722;border:1px solid #263247;border-radius:14px;padding:14px;margin:12px 0}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  label{display:flex;flex:1;gap:10px;align-items:center;color:#c2ccda}
  input[type=range]{width:100%}
  .btns{display:flex;gap:10px;flex-wrap:wrap}
  button{background:#0f1522;color:#e6edf3;border:1px solid #263247;padding:12px 14px;border-radius:12px;cursor:pointer}
  button.primary{border-color:var(--hi)}
  .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;background:#0d1421;border:1px solid #1f2a3b;color:#c7d2de;font-weight:600}
  #viz{height:260px;position:relative;overflow:hidden;border-radius:12px;background:radial-gradient(80% 65% at 50% 40%,#0c121a,#070e16 70%,#050a11)}
  canvas{position:absolute;inset:0;width:100%;height:100%}
  .sub{color:#9aa4b2;font-size:14px}
  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
  .chip{padding:8px;border-radius:10px;border:1px solid #263247;background:#0f1522;text-align:center}
  footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
  a.home{color:#9aa4b2;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ü´∞ Quantum Luck</h1>
    <span class="pill">Entropy: <span id="entropy">crypto</span></span>
  </header>

  <div class="card">
    <div class="row">
      <label>Preparedness
        <input id="prep" type="range" min="0" max="100" value="60">
      </label>
      <span class="pill">‚Üë convert chances</span>
    </div>
    <div class="row" style="margin-top:8px">
      <label>Exposure
        <input id="expo" type="range" min="0" max="100" value="50">
      </label>
      <span class="pill">‚Üë number of chances</span>
    </div>
    <p class="sub" style="margin:8px 0 0">
      Model: We sample multiple ‚Äúmicro-worlds‚Äù per click using secure randomness. <em>Exposure</em> controls how many we sample. 
      <em>Preparedness</em> improves how well you select/convert from those samples (soft-max selection + better success rate).
    </p>
  </div>

  <div class="card" id="viz">
    <canvas id="cv"></canvas>
  </div>

  <div class="card">
    <div class="btns">
      <button id="roll" class="primary">üé≤ Roll for Luck</button>
      <button id="auto">‚ñ∂ Auto</button>
      <button id="reset">‚Ü∫ Reset</button>
      <a class="home" href="index.html" style="margin-left:auto;align-self:center">‚üµ Home</a>
    </div>
    <div class="grid" id="stats">
      <div class="chip">Rolls<br><strong id="rolls">0</strong></div>
      <div class="chip">‚ÄúLucky‚Äù hits<br><strong id="hits">0</strong></div>
      <div class="chip">Hit rate<br><strong id="rate">0%</strong></div>
      <div class="chip">Best streak<br><strong id="streak">0</strong></div>
      <div class="chip">Serendipity score<br><strong id="score">0.00</strong></div>
    </div>
  </div>

  <footer class="sub">
    Built with secure entropy (<code>crypto.getRandomValues</code>) and a simple ‚Äúhidden structure‚Äù model.
  </footer>
</div>

<script>
(function(){
  "use strict";

  /* ---------- secure randomness helpers ---------- */
  function r01(){ // 0..1 using WebCrypto
    const u = new Uint32Array(1);
    crypto.getRandomValues(u);
    // divide by 2^32
    return u[0] / 4294967296;
  }
  function choice(arr){ return arr[Math.floor(r01()*arr.length)] }

  /* ---------- DOM ---------- */
  const els={
    prep:document.getElementById('prep'),
    expo:document.getElementById('expo'),
    cv:document.getElementById('cv'),
    roll:document.getElementById('roll'),
    auto:document.getElementById('auto'),
    reset:document.getElementById('reset'),
    rolls:document.getElementById('rolls'),
    hits:document.getElementById('hits'),
    rate:document.getElementById('rate'),
    streak:document.getElementById('streak'),
    score:document.getElementById('score')
  };

  /* ---------- canvas setup ---------- */
  const ctx = els.cv.getContext('2d');
  let W=0,H=0,dpr=Math.min(2,window.devicePixelRatio||1);
  function resize(){
    const r = els.cv.getBoundingClientRect();
    W = r.width; H = r.height;
    els.cv.width = Math.round(W*dpr); els.cv.height = Math.round(H*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  addEventListener('resize', resize, {passive:true}); resize();

  /* ---------- model state ---------- */
  let rolls=0, hits=0, streak=0, bestStreak=0, score=0;
  let autoTimer = null;

  // particles for visuals
  const parts=[];
  function burst(x,y,color){
    for(let i=0;i<24;i++){
      parts.push({
        x,y, vx:(r01()*2-1)*120, vy:(r01()*2-1)*120,
        life:0.9, t:0, color
      });
    }
  }

  /* ---------- ‚Äúhidden pattern‚Äù model ---------- */
  // Each roll:
  // 1) Determine number of micro-world samples N from Exposure.
  // 2) Generate N raw chances p_i ~ U(0,1).
  // 3) Preparedness acts like a temperature for softmax selection (more weight on higher p_i),
  //    then improves conversion of the selected p via a logistic uplift.
  // 4) One Bernoulli draw decides lucky/unlucky; we animate + update streaks.
  function rollOnce(){
    const prep = +els.prep.value / 100;   // 0..1
    const expo = +els.expo.value / 100;   // 0..1

    // #1 exposure -> number of samples (1..10)
    const N = Math.max(1, Math.round(1 + expo*9));

    // #2 raw chances
    const ps = new Array(N).fill(0).map(()=>r01());

    // #3 preparedness -> softmax pick
    // temperature tau in [0.15 .. 1.5] (lower = more greedy selection)
    const tau = 1.5 - prep*1.35;
    const ws = ps.map(p => Math.exp(p / tau));
    const Z = ws.reduce((a,b)=>a+b,0);
    let pick = r01()*Z, idx = 0;
    for(let i=0;i<N;i++){ pick -= ws[i]; if(pick<=0){ idx=i; break; } }
    let pSel = ps[idx];

    // logistic uplift from preparedness (better conversion of good samples)
    // uplift ‚àà [0..0.35]
    const uplift = 0.35*prep;
    pSel = Math.min(1, pSel*(1+uplift));

    // #4 resolve
    const lucky = r01() < pSel;

    // update stats
    rolls++; if(lucky){ hits++; streak++; score += (pSel + expo*0.1 + prep*0.15); }
    else { if(streak>bestStreak) bestStreak = streak; streak = 0; score -= 0.05; }

    // draw blips
    drawSpin(ps, idx, lucky, pSel);
    if(lucky){ burst(W*0.5, H*0.58, '#30d158'); }
    else{ burst(W*0.5, H*0.62, '#ff6b6b'); }

    // update UI
    els.rolls.textContent = rolls;
    els.hits.textContent  = hits;
    els.rate.textContent  = (hits? Math.round(hits/rolls*100):0) + '%';
    els.streak.textContent= Math.max(streak,bestStreak);
    els.score.textContent = score.toFixed(2);
  }

  /* ---------- visuals ---------- */
  function drawSpin(ps, idx, lucky, pSel){
    ctx.clearRect(0,0,W,H);

    // background rings
    ctx.save();
    const cx=W/2, cy=H/2;
    for(let r=0;r<6;r++){
      ctx.beginPath();
      ctx.arc(cx, cy, 40 + r*24, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(150,180,220,'+(0.12- r*0.015)+')';
      ctx.lineWidth = 2;
      ctx.stroke();
    }
    ctx.restore();

    // spokes: each micro-world sample
    const N = ps.length;
    for(let i=0;i<N;i++){
      const ang = (i/N)*Math.PI*2 - Math.PI/2;
      const rad = 36 + ps[i]*120;
      const x = cx + Math.cos(ang)*rad;
      const y = cy + Math.sin(ang)*rad;

      ctx.beginPath();
      ctx.moveTo(cx,cy);
      ctx.lineTo(x,y);
      ctx.strokeStyle = i===idx ? (lucky? 'rgba(48,209,88,0.9)':'rgba(255,107,107,0.85)') : 'rgba(90,200,250,0.18)';
      ctx.lineWidth = i===idx ? 3 : 1.5;
      ctx.stroke();

      if(i===idx){
        ctx.beginPath();
        ctx.arc(x,y,5,0,Math.PI*2);
        ctx.fillStyle = lucky ? '#30d158' : '#ff6b6b';
        ctx.fill();
      }
    }

    // selected probability text
    ctx.fillStyle='#c7d2de';
    ctx.font='14px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial';
    ctx.textAlign='center';
    ctx.fillText('selected p = '+pSel.toFixed(3), cx, cy+H*0.32);
  }

  function tick(t){
    // particles
    ctx.save(); ctx.globalCompositeOperation='lighter';
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i];
      p.t += 1/60; p.life -= 1/60;
      p.x += p.vx*(1/60); p.y += p.vy*(1/60);
      p.vx *= 0.98; p.vy = p.vy*0.98 + 25*(1/60);
      if(p.life<=0){ parts.splice(i,1); continue; }
      const a = Math.max(0, p.life);
      ctx.fillStyle = p.color.replace(')',','+a+')').replace('rgb','rgba');
      // convert '#rrggbb' to rgba if needed
      if(p.color[0]==='#'){ ctx.fillStyle = p.color; ctx.globalAlpha = a; }
      ctx.fillRect(p.x, p.y, 2, 2);
      ctx.globalAlpha = 1;
    }
    ctx.restore();
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  /* ---------- controls ---------- */
  els.roll.onclick = rollOnce;
  els.reset.onclick = function(){
    rolls=hits=streak=bestStreak=0; score=0;
    els.rolls.textContent='0'; els.hits.textContent='0'; els.rate.textContent='0%';
    els.streak.textContent='0'; els.score.textContent='0.00';
    ctx.clearRect(0,0,W,H); parts.length=0;
  };
  els.auto.onclick = function(){
    if(autoTimer){ clearInterval(autoTimer); autoTimer=null; els.auto.textContent='‚ñ∂ Auto'; return; }
    els.auto.textContent='‚èπ Stop';
    autoTimer = setInterval(rollOnce, 350);
  };

  // start with an animated draw so the rings appear
  drawSpin([0.2,0.4,0.6,0.1,0.9], 2, true, 0.6);

  // gentle auto-start after 2s so it never looks dead
  setTimeout(()=>{ if(!autoTimer && rolls===0) rollOnce(); }, 1200);

})();
</script>
</body>
</html>